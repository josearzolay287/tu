<!DOCTYPE html>
<html lang="<?php print $lang_abbr;?>"><head>

<title><?php print $settings['html_title'];?></title>
<meta charset="utf-8" />
<meta name="referrer" content="<?php print $settings['meta_ref'];?>" />
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="stylesheet" href="blabax.css?xyz=<?php print $settings['forcereload'];?>" />
<link rel="stylesheet" href="emoticons.css?xyz=<?php print $settings['forcereload'];?>" />
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<!--  Bootstrap -->
  <link rel="stylesheet" href="../assets/bootstrap/css/bootstrap.min.css">
<!--  Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>



<script src="recorderControl.js"></script>

<script src="jquery.min.2.1.js"></script>
<script src="https://cdn.rawgit.com/mattdiamond/Recorderjs/08e7abd9/dist/recorder.js"></script>


<style>
.g1{}
<?php
  print $bgrooms;
  print "\n";
  print $css_colors;
  print "\n";
  print $settings['style_delivery'];
  print "\n";
  print $settings['msg_style'];
  print $settings['webkit_css'];
?>
</style>


<style type="text/css">
  body{
    font-family:Verdana, Geneva, Arial, Helvetica, sans-serif;
    font-size:16px;
    text-align:center;
  }

  p{
    margin:10px;
  }

  input[type="button"]{
    background:#CCC;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-size:1em;
    padding:5px;
  }

  input[type="button"]:hover{
    background:#666;
  }

 .svg_avbt{
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDguNSA4LjUiPjxwYXRoIGQ9Ik0zLjQyNi4wMUMxLjk4Ni4wNzIuNjMgMS4wOS4xODIgMi40OTMtLjE5IDMuNTkzLjAxOCA0Ljg3LjcyIDUuNzg4TC4yMzQgNy44NjNsMi4wNDMtLjg4YzEuMzguNTcgMy4wNzYuMTc4IDQuMDY4LS45NTYuOTItLjk5OCAxLjE4Ni0yLjU1Mi42NDMtMy44MDVDNi40MTIuODEyIDQuOTEyLS4xMDggMy40MjUuMDF6IiBmaWxsPSIjZmZmIi8+PHBhdGggZD0iTTUuMDQuNjE0YzEuNDQyLjA2MiAyLjc5NiAxLjA4IDMuMjQ1IDIuNDgzLjM3MiAxLjEuMTY0IDIuMzc3LS41MzcgMy4yOTVsLjQ4MyAyLjA3NS0yLjA0LS44OGMtMS4zOC41Ny0zLjA3OC4xNzgtNC4wNy0uOTU2LS45MTgtLjk5Ny0xLjE4NS0yLjU1LS42NDItMy44MDRDMi4wNTQgMS40MTYgMy41NTMuNDk2IDUuMDQuNjE0eiIgZmlsbD0iI2Q0MDA1NSIvPjxwYXRoIGQ9Ik0zLjkwNyAzLjAyN2wyLjQ2NCAxLjI5LTIuMzk0IDEuMjU1eiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==);
  }

  .svg_pausa{
    background-image: url(pausa.png);
  }

  .svg_detener{
    background-image: url(detener.png);
  }

  .bottom_bmore{
    position: fixed;
    left: 40px;
    bottom: 5px;
    width: 35px;
    height: 40px;
    background-repeat: no-repeat;
    background-size: 75%;
    background-position: center;
    cursor: pointer;
  }
  .sfade1{
    opacity: 1;
    transition: 0.4s opacity;
    display:block !important;
  }
  #bottom_dmore{
    position: fixed;
    left: 75px;
    bottom: 5px;
    height: 40px;
    display:none;
  }
  #bottom_dmore div {
    float: left;
    width: 30px;
    height: 40px;
    background-repeat: no-repeat;
    background-size: 70%;
    background-position: center;
    cursor: pointer;
  }
  .svg_aonn {
    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj48cGF0aCBkPSJNMzIgMTZhMTYgMTYgMCAwIDEtMTYgMTZBMTYgMTYgMCAwIDEgMCAxNiAxNiAxNiAwIDAgMSAxNiAwYTE2IDE2IDAgMCAxIDE2IDE2eiIgZmlsbD0iI2YwNiIvPjxwYXRoIGQ9Ik0xNiAxOC41YzEuNjYgMCAyLjk5LTEuMzQgMi45OS0zbC4wMS02YzAtMS42Ni0xLjM0LTMtMy0zcy0zIDEuMzQtMyAzdjZjMCAxLjY2IDEuMzQgMyAzIDN6bTUuMy0zYzAgMy0yLjU0IDUuMS01LjMgNS4xcy01LjMtMi4xLTUuMy01LjFIOWMwIDMuNDEgMi43MiA2LjIzIDYgNi43MnYzLjI4aDJ2LTMuMjhjMy4yOC0uNDggNi0zLjMgNi02LjcyeiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==);
  }
  .audioContainer{
    height:50px;width:250px;
    border:solid 1px #dedede;
    position:relative;
  }
  .audioProgress{
    height:50px;
    float:left;
    background-color:#f2f2f2;z-index:800
  }
  .null{

  }
  .audioControl{
    position: absolute;
    float:left;
    width:52px;
    height:48px;
  }
  .audioTime
  {
    position: absolute;
    width: 45px;
    height: 20px;
    margin-left:199px;
    float:right;
  }
  .audioBar{
    height: 3px;
    background-color: #cc0000;
    position: absolute;
    width: 147px;
    margin-left: 53px;
  }
  .ocultar{
    display:none;
  }

  .smiley_none{}
  .gif_none{}
  .meme_none{}
  .audio_none{}

  .modalContainer {
      display: none;
      position: fixed;
      z-index: 1;
      padding-top: 100px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(0,0,0);
      background-color: rgba(0,0,0,0.4);
    }

    .modalContainer .modal-content {
      background-color: #fefefe;
      margin: auto;
      padding: 20px;
      border: 1px solid lightgray;
      border-top: 10px solid #58abb7;
      width: 60%;
    }

    .modalContainer .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }

    .modalContainer .close:hover,
    .modalContainer .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }

  .dinero{
    margin-right: 20%;
    position: absolute;
    margin-left: 19%;
    display:inline-block;
  }

  .svg_dinero{
     background-image: url(icons/pila_monedas_oro.png);
  }

  .oneline_text{
    position: absolute;
    right: 350%;
    text-align: justify;
  }
  .text_float{
    overflow: hidden;
    text-align:center;
    min-height: 100px;
    min-width: 100px;
    max-height: 100px;
    min-width: 100px;
    word-wrap:break-word;
  }

</style>

<script type="text/JavaScript">

  function changeClass(){


  }

  // window.onload = function(){
  //   let eve = document.getElementsByClassName("bottom_bmore")[0]
  //   eve.addEventListener('click', changeClass);
  // }

  var repeat = 1                    // Si ponemos valor 0 sólo se repetirá unavez el movimiento
  var title = document.title
  var leng = title.length
  var start = 1

  function titlemove(){
    titl = title.substring(start, leng) + title.substring(0, start)
    document.title=titl
    start++
    if (start==leng+1){
      start=0
      if (repeat==0) return
    }
    setTimeout("titlemove()",150)  // 150 es la velocidad de movimiento, se puede ampliar o reducir
  }

  if (document.title) titlemove()

// <!-- FIN CODIGO TITULO MOVIMIENTO -->

  <?php
    if(isset($_COOKIE['mobileapp'])){
      $mpp=(int)$_COOKIE['mobileapp'];
      print 'mobileapp='.$mpp.';';
    }else{
      print 'mobileapp=0;';
    }
  ?>

  if(mobileapp==3){
    parent.postMessage('savecookie','*')
  }

  roomhistbutton=''; privhistbutton='';

  msg_template='<?php print $settings['msg_template'];?>';
  <?php
    if($settings['msg2db']>0){
  ?>
      roomhistbutton='<div style="display:inline-block;margin-bottom:5px;min-height:24px" class="history_button svg_hist x_bcolor_x x_all_rounded" onclick="show_r_history(this)"><b><?php print $lang['history'];?></b>&nbsp;&nbsp;</div><br />'

      privhistbutton='<div style="display:inline-block;margin-bottom:5px;min-height:24px" class="history_button svg_hist x_bcolor_y x_all_rounded" onclick="show_p_history(this)"><b><?php print $lang['history'];?></b>&nbsp;&nbsp;</div><br />'
  <?php
    }
  ?>

</script>

<script src="sounds.js?xyz=<?php print $settings['forcereload'];?>"></script>
<script src="blabax.js?xyz=<?php print $settings['forcereload'];?>"></script>

</head>

<body onload="init()" class="x_blab x_overal">

  <div id="rbgcolor" class="top_area" style="top:5px"></div>

  <div class="x_bcolor_z top_area">

    <div class="status_select"
      <?php
        if($user_visible>0){
          print 'onclick="hst.style.display=\'block\';hoop(ons,1)"';
        }else{
          print 'style="opacity:0.3"';
        }
      ?>
    >
      <span id="curr_status_ico" class="pchat_notify status1"></span>
      <span id="curr_status_nme">
        <?php
          if($user_visible>0){
            print str_replace(explode(',',$lang['statusp']),'',$lang['status1']);
          }else{
            print $lang['status0'];
          }
        ?>
      </span>
      &nbsp;
    </div>

    <div id="top_unread"
        class="x_accent_bg"
        onclick=" swap_panel(0);
                  hst.style.display='block';
                  pab.style.display='block';
                  hoop(pan,1)"
    >
    </div>
    <div
      id="top2unread"
      class="x_accent_bg"
      onclick=" swap_panel(5);
                hst.style.display='block';
                pab.style.display='block';
                hoop(pan,1)"
    >
    </div>

    <div
      class="top_button svg_more"
      onclick=" if(de('panel_pmlog').style.display=='block'){
                  hidepm_notify()
                }
                hst.style.display='block';
                pab.style.display='block';
                hoop(pan,1)"
    >
    </div>
  </div>

  <div
    class="bgbwsp"
    id="chat_area"
      <?php
        if($settings['drag2scroll']>0){
          print 'onmousedown="mdown(event)" onmousemove="mmove(this,event)" ondblclick="nselect(1)"';
        } ?>
  >

    <div class="spinner">
      <div class="bounce1 x_accent_bg"></div>
      <div class="bounce2 x_accent_bg"></div>
      <div class="bounce3 x_accent_bg"></div>
    </div>

  </div>

  <?php
    print $settings['customjs'];
  ?>

  <div id="online_button" class="x_bcolor_z x_circle svg_usrs" onclick="display_layout_frs(1)">
    <span id="global_notify" class="pchat_notify"></span>
  </div>

  <div id="online_title">
    <div onclick="display_layout_frs(0)" class="online_title_close svg_clos"></div>
     <div class="online_title_close svg_dinero"></div>
    <div class="online_title_text">
      <?php print $lang['online'];?>
      <div class="dinero">10</div>
      </div>
  </div>

  <div id="online_users" onmousedown="m2down(event)" onmousemove="m2move(this,event)">

  </div>

  <div id="autoscroll" class="x_accent_bg x_circle svg_down" onclick="ascroll()"></div>

  <div
    id="hidescreen_part"
    class="x_overal"
    onclick="if(blockuserchange<1){
              if(srv_usr_id!=0){
                hide_user()
              }
              hsp.style.display='none';
              if(lof.style.display=='block'){
                hoop(lof,0)
              }
              inp_focus()
            }">
  </div>

  <div id="user_info" class="x_bcolor_x x_top_rounded">
    <div id="user_avatar" class="pointer x_circle" onclick="ext_profile()"></div>
    <div style="float:left;margin-left:5px;margin-top:10px">
      <div id="user_name" style="font-size:14px;cursor:pointer;" onclick="ext_profile()">&nbsp;</div>
      <small id="user_motto"></small>
    </div>
  </div>

  <div id="user_buttons" class="user_butt x_bcolor_x">
    <span
      title="<?php print $lang['un_mute'];?>"
      class="x_circle x_bcolor_z pointer svg_mute"
      id="ig_unig"
      onclick="shoop(this,1,100);ignore_set()">&nbsp;
    </span>
      <?php
        if($uid==1){
      ?>
        <span
          onclick="shoop(this,1,100);
                  if(blockuserchange<1){
                    hoop('kick_ban',1)
                  }"
          title="<?php print $lang['kick'].'/'.$lang['ban'];?>"
          class="x_circle x_bcolor_z pointer svg_kick">&nbsp;
        </span>
      <?php
        }
      ?>
  </div>

  <div id="kick_ban" class="user_butt x_all_rounded x_bcolor_x">
    <?php
      if($uid==1){
    ?>
        <span onclick="ban_user(0)" title="<?php print $lang['kick'];?>" class="x_circle x_bcolor_z pointer svfg_kick">&nbsp;</span>

        <span onclick="ban_user(1)" title="<?php print $lang['ban'];?>: ID" class="x_circle x_bcolor_z pointer svg_bann">
          <small style="padding:4px;font-size:10px;position:relative;top:-10px" class="x_overal">
            &nbsp;id&nbsp;
          </small>
        </span>

        <span onclick="ban_user(2)" title="<?php print $lang['ban'];?>: ID+IP" class="x_circle x_bcolor_z pointer svg_bann">
          <small style="padding:4px;font-size:10px;position:relative;top:-10px" class="x_overal">
            &nbsp;id/ip&nbsp;
          </small>
        </span>

        <span onclick="shoop(this,1,100);hoop('kick_ban',0)" title="<?php print $lang['cancel'];?>" class="x_circle x_bcolor_z pointer svg_clos">
          &nbsp;
        </span>

    <?php
      }
    ?>
  </div>

  <div id="private_chats"></div>
  <div id="box_emoji_stickers" class="x_bcolor_y x_all_rounded">

    <div id="list_of_emoji" class="smiley_none ocultar">
       <?php
        foreach ($smileys as $smiley) {
          $porciones = explode("/", $smiley);
          $v1 = $porciones[1];
          $v  = $porciones[2];
          $extencion = explode(".",$v);
          $f = $v1.'_'.$extencion[0];
        ?>
         <span style="cursor:pointer;" onclick="
          shoop(this,1,100);
          montar_new_emoticon('<?php print $f; ?>');
          ">
            <img src="<?php print $smiley; ?>">
          </span>
      <?php
      }
      ?>
    </div>
    <div id="list_of_emoji" class="gif_none ocultar">
       <?php
        foreach ($gifs as $gif) {
          $porciones = explode("/", $gif);
          $v1 = $porciones[1];
          $v  = $porciones[2];
          $extencion = explode(".",$v);
          $extencion = explode(".",$v);
          $f = $v1.'_'.$extencion[0];
        ?>
         <span style="cursor:pointer;" onclick="
          shoop(this,1,100);
          montar_new_emoticon('<?php print $f; ?>');
          ">
            <img src="<?php print $gif; ?>">
          </span>
      <?php
      }
      ?>
    </div>

    <div id="list_of_emoji" class="meme_none ocultar">
       <?php
        foreach ($memes as $meme) {
          $porciones = explode("/", $meme);
          $v1 = $porciones[1];
          $v  = $porciones[2];
          $extencion = explode(".",$v);
          $f = 'sticker_'.$extencion[0];
        ?>
         <span style="cursor:pointer;" onclick="
          shoop(this,1,100);
          montar_new_emoticon('<?php print $f; ?>');
          ">
            <img  width="60px" height="60px" src="<?php print $meme; ?>">
          </span>
      <?php
      }
      ?>
    </div>

    <div id="list_of_emoji" class="audio_none ocultar">
     <span style="cursor:pointer;" onclick="
      shoop(this,1,100);
      ">
      <h5 id="grabando" class="null ocultar">Grabando...</h5>
        <section class="main-controls">
          <canvas class="visualizer" height="20px"></canvas>
          <div id="buttons">
            <button class="record">Grabar</button>
            <button class="stop_audio">Detener</button>
          </div>
          <br>
        </section>

      <section class="sound-clips"></section>
      </span>
    </div>

    <div id="list_of_emoji" class="smiley_none"><?php print $emos2dv;?></div>

    <div id="list_of_stickers" style="margin-top:10px;display:none"></div>
    <b
      id="emoji_button"
      onclick="if(!obj2hoop){
                hoop(lie,1);
                mostrar_ocultar_smaley(0);
                shoop(this,1,100)
              }"
      class="pointer x_all_rounded x_bcolor_z svg_bemo"
      style="width:80px;border-radius: 15px;">
        &nbsp;
    </b>

            <!-- Stikers -->

    <?php
      print '<b onclick="if(!obj2hoop){
          lie.style.display=\'none\';
          sti.style.display=\'none\';
          mostrar_ocultar_gif(0);
          hoop(sti,1);
          lof.scrollTop=lof.scrollHeight;
          shoop(this,1,100)
        }"
        class="pointer x_bcolor_z x_all_rounded"
        style="width:80px;border-radius: 15px;">Gif</b>'."\n";


      print '<b onclick="if(!obj2hoop){
          lie.style.display=\'none\';
          sti.style.display=\'none\';
          mostrar_ocultar_meme(0);
          hoop(sti,1);
          lof.scrollTop=lof.scrollHeight;
          shoop(this,1,100)
        }"
        class="pointer x_bcolor_z x_all_rounded"
        style="width:80px;border-radius: 15px;">Stickers</b>'."\n";


      print '<b onclick="if(!obj2hoop){
          lie.style.display=\'none\';
          sti.style.display=\'none\';
          montar_audio(0);
          hoop(sti,1);
          lof.scrollTop=lof.scrollHeight;
          shoop(this,1,100)
        }"
        class="pointer x_bcolor_z x_all_rounded svg_aonn"
        style="width:80px;border-radius: 15px;">.</b>'."\n";

    ?>


  </div>

  <form action="?do" onsubmit="msg_send();return false" autocomplete="off">

    <div id="bottom_middle" class="x_bcolor_z">

      <input
        type="text"
        id="text_input"
        spellcheck="true"
        maxlength="320"
        placeholder=" <?php print $lang['message'];?> "
      />

    </div>

    <div
      id="bottom_smile" class="x_bcolor_z x_left_rounded svg_emtn"
      onclick="if(chatflow<1){
        if(lof.style.display=='block'){
          if(srv_usr_id==0){
            hsp.style.display='none'
          }
          shoop(this,1,100);
          hoop(lof,0)
        }else{
          if(srv_usr_id==0){
            hsp.style.display='block'
          }
          shoop(this,1,100);
          hoop(lof,1)
        }
      }
    ">
    </div>

   <!--  <div id="bottom_bmore" style="margin-left:22px;" title="Voice message - Video message - Doodle - Upload" class="x_bcolor_z x_left_rounded svg_aonn" onclick="startRecording(); changeClass()">
    </div> -->

    <div id="bottom_dmore" class="null">

      <div style="width:5px;cursor:default"></div>
     <!--  <div id="recordButton" title="Voice message" class="svg_aonn" onclick="startRecording()"></div> -->
 <!--      <div id="pauseButton" title="Voice message" class="svg_pausa" onclick="pauseRecording()"></div> -->
    <!--   <div id="stopButton" title="Voice message" class="svg_detener" onclick="stopRecording()"></div> -->


      <div
        title="Doodle"
        class="svg_dbtn"
        onclick="obj2hoop=false;
                lof.style.display='none';
                if(srv_usr_id==0){
                  hsp.style.display='none'
                }
                preview(0,13);
                de('bottom_dmore').style.display='none'"
      >
      </div>

      <label
        for="fupload"
        title="Upload"
        class="svg_upbt"
        onclick=" de('bottom_dmore').style.display='none';
                  hst.style.display='block';
                  pab.style.display='block';
                  hoop(pan,1);swap_panel(4);
                  if(fmedia_load<1){
                    fmd.src='fmedia.php?stoken=4888z29c9c349534f18fff5bcf97d4febd05a70b93451ce12bbd6e46f388dcec0140d'
                  };
                  fmedia_load=1"
      >
      </label>

      <div style="width:5px;cursor:default"></div>
    </div>

    <div
      id="bottom_send"
      class="x_bcolor_z x_right_rounded svg_send"
      onclick="
      shoop(this,1,100);
      msg_send()">
    </div>

  </form>

  <div
    id="hidescreen_tran"
    class="x_overal"
    onclick=" this.style.display='none';
              if(pan.style.display=='block'){
                pab.style.display='none';
                hoop(pan,0)
              }
              if(ons.style.display=='block'){
                hoop(ons,0)
              }
              inp_focus()">
  </div>

  <div id="statuses" class="x_bcolor_y x_all_rounded">
    <div style="height:2px"></div>
    <?php
      $statp=explode(',',$lang['statusp']);
    ?>

    <div onclick="change_status(1,'<?php print str_replace($statp,'',$lang['status1']);?>')">
      <i class="pchat_notify status1"></i>
        <?php
          print $lang['status1'];
        ?>
    </div>

    <div
      onclick="change_status(2,'<?php print str_replace($statp,'',$lang['status2']);?>')">
      <i class="pchat_notify status2"></i>
        <?php
          print $lang['status2'];
        ?>
    </div>

    <div onclick="change_status(3,'<?php print str_replace($statp,'',$lang['status3']);?>')">
      <i class="pchat_notify status3"></i>
      <?php
        print $lang['status3'];
      ?>
    </div>

    <div onclick="change_status(4,'<?php print str_replace($statp,'',$lang['status4']);?>')">
      <i class="pchat_notify status4"></i>
      <?php
        print $lang['status4'];
      ?>
    </div>

    <div onclick="change_status(5,'<?php print str_replace($statp,'',$lang['status5']);?>')">
      <i class="pchat_notify status5"></i>
        <?php
          print $lang['status5'];
        ?>
    </div>
    <div style="height:8px"></div>
  </div>

  <!-- PANEL BEGIN -->

  <div id="panel_left" class="x_bcolor_y" style="background: #7cb3e9;
      border: 1px solid #7cb3e9;">

    <div id="panel_settings" style="display:none">

      <div class="panel_title x_accent_bb" style="text-align:center">
        <?php
          print $lang['settings'];
        ?>
      </div>

      <input
        id="ampm"
        class="x_all_rounded x_bcolor_z panel_button"
        title="24H AM/PM" type="button"
        style="width:43%;margin:1%"
        value=" 24h "
        onclick="shoop(this,1,100);swap_ampm(1)"
      />

      <input
        id="sndd"
        class="panel_button x_bcolor_z x_all_rounded svg_sndd"
        title="<?php
          print $lang['on'].'/'.$lang['off'];
        ?>"
        type="button"
        style="width:43%;margin:1%"
        onclick="shoop(this,1,100);swap_sound(1)"
        value="&nbsp;"
      />

      <div style="margin-top:20px">

        <select
          onchange="self.location.href='index.php?room='+current_room+'&plng='+this.value"
          class="x_bcolor_y x_accent_bb panel_input"
        >
          <?php
            print $lang2select;
          ?>
        </select>

      </div>

      <div class="panel_title panel_sounds">
        <input
          id="snd1oo"
          type="button"
          onclick="shoop(this,1,100);sound_opt(1)"
          class="pointer x_bcolor_z x_left_rounded svg_sndd"
          value="&nbsp;"
        />
        <span class="x_overal x_right_rounded">
          <?php
            print $lang['sound1'];
          ?>
        </span> <br/>
      </div>

      <div class="panel_title panel_sounds">
        <input
          id="snd2oo"
          type="button"
          onclick="shoop(this,1,100);sound_opt(2)"
          class="pointer x_bcolor_z x_left_rounded svg_sndd"
          value="&nbsp;"
        />
        <span class="x_overal x_right_rounded">
          <?php
            print $lang['sound2'];
          ?>
        </span> <br/>
      </div>

      <div class="panel_title panel_sounds">
        <input
          id="snd4oo"
          type="button"
          onclick="shoop(this,1,100);sound_opt(4)"
          class="pointer x_bcolor_z x_left_rounded svg_sndd"
          value="&nbsp;"
        />
        <span class="x_overal x_right_rounded">
          <?php
            print $lang['sound4'];
          ?>
        </span> <br/>
      </div>

      <div class="panel_title panel_sounds">
        <input
          id="snd3oo"
          type="button"
          onclick="shoop(this,1,100);sound_opt(3)"
          class="pointer x_bcolor_z x_left_rounded svg_sndd"
          value="&nbsp;"
        />
        <span class="x_overal x_right_rounded">
          <?php
            print $lang['sound3'];
          ?>
        </span> <br/>
      </div>

      <div class="panel_title panel_sounds">
        <input
          id="snd5oo"
          type="button"
          onclick="shoop(this,1,100);sound_opt(5)"
          class="pointer x_bcolor_z x_left_rounded svg_sndd"
          value="&nbsp;"
        />
        <span class="x_overal x_right_rounded">
          <?php
            print $lang['sound5'];
          ?>
        </span> <br/>
      </div>

      <div class="panel_title x_accent_bb" style="margin-top:20px"></div>

      <div id="colors_div" style="width:90%;margin:auto;margin-top:20px">
        <?php
          print $colors;
        ?>
      </div>

    </div>

    <div id="panel_profile" style="display:none">
      <div
        class="panel_title x_accent_bb"
        style="text-align:center">
          <?php
            print $lang['profile'];
            ?>
      </div>

      <?php
        if($xuser['bwsuser']==2){
      ?>

      <form action="profile.php" method="post" autocomplete="off" onsubmit="return user_check_form()">

        <div>
          <input
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_user"
            value="<?php print $uname;?>"
            readonly="readonly"
          />
        </div>

        <div>
          <input
            name="newpass"
            type="password"
            class="x_bcolor_y x_accent_bb panel_input svg_pass"
            placeholder="<?php print $lang['new_pass'];?>"
            onfocus="panput_style_back(this, 'svg_pass')"
          />
        </div>

        <div id="rt" style="display:none">

          <div>
            <input
              name="retype"
              type="password"
              class="x_bcolor_y x_accent_bb panel_input svg_pass"
              placeholder="<?php print $lang['retype'];?>"
              onfocus="panput_style_back(this, 'svg_pass')"
            />
          </div>

          <div>
            <input
              name="oldpass"
              type="password"
              class="x_bcolor_y x_accent_bb panel_input svg_pass"
              placeholder="<?php print $lang['old_pass'];?>"
              onfocus="panput_style_back(this, 'svg_pass')"
            />
          </div>

        </div>

        <div style="height:20px"></div>

        <div>
          <input
            name="email"
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_mail"
            placeholder="<?php print $lang['email'];?>"
            value="<?php $str_esc=htmlspecialchars($xuser['email']);print $str_esc;?>"
            onfocus="panput_style_back(this, 'svg_mail')"
          />
          <input
            type="hidden"
            name="dbmail"
            value="<?php print $str_esc;?>"
          />
        </div>

        <div id="qa" style="display:none">

          <div>
            <input
              name="question"
              type="text"
              class="x_bcolor_y x_accent_bb panel_input svg_psqn"
              value="<?php $str_esc=htmlspecialchars($xuser['question']);print $str_esc;?>"
              readonly="readonly"
            />
          </div>
          <div>
            <input
            name="answer"
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_psar"
            placeholder="<?php print $lang['fpr_answer'];?>"
            onfocus="panput_style_back(this, 'svg_psar')"
            />
          </div>

        </div>

        <div>
          <input type="hidden" name="room" value="0" />
          <input
            id="prosubbutton"
            style="width:90%;height:50px;margin-top:30px"
            class="x_all_rounded x_bcolor_z panel_button"
            type="submit"
            value="<?php print $lang['submit'];?>"
          />
        </div>

      </form>

      <?php
        }elseif($xuser['bwsuser']==1 && $settings['allow_reg']>0){
      ?>

      <form action="profile.php" method="post" autocomplete="off" onsubmit="return guest_check_form()">

        <div>
          <input
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_user"
            value="<?php print $uname;?>"
            readonly="readonly"
          />
        </div>
        <div>
          <input
            name="password"
            type="password"
            class="x_bcolor_y x_accent_bb panel_input svg_pass"
            placeholder="<?php print $lang['password'];?>"
            onfocus="panput_style_back(this, 'svg_pass')"
          />
        </div>
        <div>
          <input
            name="retype"
            type="password"
            class="x_bcolor_y x_accent_bb panel_input svg_pass"
            placeholder="<?php print $lang['retype'];?>"
            onfocus="panput_style_back(this, 'svg_pass')"
          />
        </div>
        <div>
          <input
            name="email"
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_mail"
            placeholder="<?php print $lang['email'];?>"
            onfocus="panput_style_back(this, 'svg_mail')"
          />
        </div>
        <div style="height:20px"></div>
        <div>
          <input
            name="question"
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_psqn"
            placeholder="<?php print $lang['fpr_question'];?>"
            onfocus="panput_style_back(this, 'svg_psqn')"
          />
        </div>
        <div>
          <input
            name="answer"
            type="text"
            class="x_bcolor_y x_accent_bb panel_input svg_psar"
            placeholder="<?php print $lang['fpr_answer'];?>"
            onfocus="panput_style_back(this, 'svg_psar')"
          />
        </div>
        <div>
          <input
            type="hidden"
            name="room"
            value="0"
          />
          <input
            id="prosubbutton"
            style="width:90%;height:50px;margin-top:30px"
            class="x_all_rounded x_bcolor_z panel_button"
            type="submit"
            value="<?php print $lang['submit'];?>"
          />
        </div>

      </form>

      <?php
        }
      ?>
    </div>

    <div id="panel_rooms" style="display:none;">
      <div class="panel_title x_accent_bb" style="text-align:center">Select Room</div>

      <?php

        $rcodecn=0; $rcodejs='';

        foreach($rooms as &$room){

          $rcodecn+=1;$rcodejs.='rcodes['.$rcodecn.']='.$room[0].';';
          $rcodepn=$rcodecn.'. ';

          if($rcodecn>9){
            $rcodepn='';
          }

          $rname=htmlspecialchars($room[1]); $rdesc=htmlspecialchars($room[2]);

          print '<div
                    class="x_accent_bb pointer panel_room"
                    style="text-align:left;
                          color:black;
                          font-family: Tahoma;
                          height: 59px;
                          border-radius: 6px;
                          margin: 5px 10px 2px 10px;
                          background: url(https://tu-chat.com/htmlchat/img/skin/default/topcmm-123flashchat-roomlist-container-one-room-block-bg.png) repeat-x;
                          border-color: #c4d2e2 #a2b4c7 #a2b4c7 #a2b4c7;
                          border-style: solid;
                          border-width: 1px;"
                    onclick="change_room('.$room[0].');manage_esc()">'."\n";
                    print'<div
                            id="unr'.$room[0].'"
                            class="x_all_rounded x_bcolor_z"
                            style="border-color:#'.$room[3].'"
                          >
                          0
                          </div>'."\n";

                    print '<span>'.$rcodepn.$rname.'</span> <br/>
                          <small>'.$rdesc.'</small>'."\n";

                    print '<br style="clear:both" />&nbsp;
          </div>'."\n\n";

        }

      ?>

    </div>

    <div id="panel_pmlog" style="display:none">

      <div class="panel_title x_accent_bb" style="text-align:center"><?php print $lang['pmlog'];?></div>

      <div
        class="panel_title x_accent_bb"
        style="font-size:90%;text-align:left;margin:20px;margin-left:5%;padding-bottom:25px;margin-bottom:30px">
        <input
          id="pmreg"
          class="panel_button x_bcolor_z x_all_rounded"
          title="<?php print $lang['on'].'/'.$lang['off'];?>"
          type="button"
          style="width:50px;margin:0;margin-left:10px;float:right"
          onclick="shoop(this,1,100);
                  swap_pmreg(1,'<?php print $lang['on'];?>','<?php print $lang['off'];?>')"
          value="<?php print $lang['off'];?>"
        />

          <?php
            print $lang['pmlogd'];
          ?>

       </div>

      <div id="pmlog_container" style="width:90%;margin:auto">
        <?php
          print $pmlog;
        ?>
      </div>

    </div>

    <div id="panel_avatar" style="display:none">

      <div class="panel_title x_accent_bb" style="text-align:center">
        <?php
          print $lang['avatar'];
        ?> &amp;
        <?php
          print $lang['motto'];
        ?>
      </div>


      <form action="mavatar.php" method="post" autocomplete="off" enctype="multipart/form-data" onsubmit="this.room.value=current_room;return true">

        <input
          id="avupload"
          type="file"
          name="avupload"
          style="display:none"
          onchange="avformcheck(this,<?php print $settings['avatar_msize'];?>)"
          accept=".jpg,.jpeg,.png"
        />

        <img style="float:left" src="<?php print $myavatar;?>" id="my_avatar_pic" alt="" />

        <div style="text-align:left;font-size:12px">
          <?php
            print $lang['upload_ms'];
          ?>
        </div>

        <?php
          $max=(int)$settings['avatar_msize'];
          $max=round($max/1024);
        ?>

        <br style="clear:both"/>

        <div style="margin:5%">
          <label
            id="lblforup"
            for="avupload"
            class="x_bcolor_z x_left_rounded pointer"
            style="float:left;width:50%;height:40px;line-height:40px;text-align:center;font-size:90%;font-weight:bold">
              <?php
                print $lang['select'];
              ?>
          </label>
          <small
            class="x_overal x_right_rounded"
            style="float:left;width:50%;;height:40px;line-height:40px;text-align:center" id="avmaxsizedesc">Max: <?php print $max;?> kB
          </small>
          <br style="clear:both"/>
        </div>

        <input
          type="text"
          id="motto"
          name="motto"
          class="x_bcolor_y x_accent_bb panel_input svg_psar"
          value="<?php print $mymotto;?>"
          placeholder="<?php print $lang['motto'];?>"
          maxlength="64"
        />
        <input type="hidden" name="stoken" value="<?php print $stoken;?>"/>
        <input type="hidden" name="room" value="0" />
        <input type="hidden" id="avatar" name="avatar" value="<?php print $myavatar;?>"/>
        <input type="hidden" id="avinit" value="<?php print $myavatar;?>"/>
        <div>
          <input
            id="avmottosbutton"
            style="width:90%;height:50px"
            class="x_all_rounded x_bcolor_z panel_button"
            type="submit"
            value="<?php print $lang['submit'];?>"
          />
        </div>

      </form>

      <div style="margin-top:30px" id="avatar_list"></div>

    </div>

      <div id="panel_ctab" style="display:none">

        <div class="panel_title x_accent_bb" style="text-align:center">
          <?php
            $x=htmlspecialchars($settings['ctab_title']);
            print $x;
          ?>
        </div>
        <?php
          print $settings['ctab_content'];
        ?>
      </div>
    <br/>
  </div>

  <div id="panel_bottom" class="x_bcolor_z">

    <?php
      if($uid==1){
    ?>
      <span
        class="x_circle x_bcolor_z pointer svg_admn"
        title="<?php print $lang['acp'];?>"
        onclick="if(mobileapp>0){
                    gourl('admin.php')
                  }else{
                    manage_esc();
                    acpwin=window.open('admin.php','acp');
                    acpwin.focus()
                  }"
      ></span>
      <?php
        }
      ?>

    <?php
      if($settings['ctab_display']>0){
    ?>
        <span
          class="x_circle x_bcolor_z pointer <?php print $settings['ctab_icon'];?>"
          title="<?php $x=htmlspecialchars($settings['ctab_title']);print $x;?>"
          onclick="shoop(this,1,100);swap_panel(4)"
        ></span>
    <?php
      }
    ?>

    <span
      id="bot_unread"
      style="position:absolute;width:8px;height:8px;z-index:1;border-radius:100%"
      class="x_accent_bg">
    </span>

    <?php
      if(count($rooms)>1){
    ?>
        <span
          class="x_bcolor_z pointer svg_room"
          title="<?php print $lang['rooms'];?>"
          onclick="shoop(this,1,100);swap_panel(0)"></span>
    <?php
      }
    ?>

    <span
      id="bot2unread"
      style="position:absolute;width:8px;height:8px;z-index:1;border-radius:100%;opacity:0"
      class="x_accent_bg">
    </span>

    <span
      class="x_bcolor_z pointer svg_pmms"
      title="<?php print $lang['pmlog'];?>"
      onclick="shoop(this,1,100);swap_panel(5)">
    </span>

    <span
      class="x_circle x_bcolor_z pointer svg_sett"
      onclick="shoop(this,1,100);swap_panel(1)"
      title="<?php print $lang['settings'];?>">
    </span>
    <?php
      if($xuser['bwsuser']>0 && ($settings['allow_reg']>0 || $xuser['bwsuser']==2)){
    ?>
        <span
          class="x_circle x_bcolor_z pointer svg_user"
          onclick="shoop(this,1,100);swap_panel(2)"
          title="<?php print $lang['profile'];?>"></span>
    <?php
     }
    ?>

    <span
      class="x_circle x_bcolor_z pointer svg_avtr"
      onclick="shoop(this,1,100);swap_panel(3);load_avatars()"
      title="<?php print $lang['avatar'].' &amp; '.$lang['motto'];?>">
    </span>

    <?php
      $exitaction='cnf=confirm(\''.$lang['exitt'].'?\');
      if(cnf){
        ax_ping(1);
        setTimeout(\'gourl(\\\'account.php\\\')\',500)}';
    ?>
    <span
      class="x_circle x_bcolor_z pointer svg_exit"
      title="<?php print $lngexit=$lang['exitt'];?>"
      onclick="<?php print $exitaction;?>">
    </span>

  </div>
  <!-- PANEL END -->

  <div id="hidescreen_opaq" class="x_overal"></div>
  <div
    id="system_info"
    class="x_bcolor_y x_all_rounded pointer"
    onclick="u=self.location.href.toString();gourl(u)">
  </div>
  <div id="hidescreen_blur"></div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script>
  var activar_smaley = 0

  function open_ventana_url(url) {
    window.open(url)
  }

  function montar_new_emoticon (emoticon) {
    document.getElementById("text_input").value += ' ' + emoticon + ' '
  }


  function mostrar_ocultar_smaley (valor) {

    let smiley = document.getElementsByClassName('smiley_none')[0]
    let gif = document.getElementsByClassName('gif_none')[0]
    let meme = document.getElementsByClassName('meme_none')[0]
    let audio = document.getElementsByClassName('audio_none')[0]

    let cadena_text_audio = audio.className
    let oculto_audio = cadena_text_audio.substr(11,18)

    let cadena_text_meme = meme.className
    let oculto_meme = cadena_text_meme.substr(10,18)

    let cadena_text_smaley = smiley.className
    let ocultar_smaley = cadena_text_smaley.substr(12,19)

    let cadena_text_gif = gif.className
    let oculto_gif = cadena_text_gif.substr(9,16)

    if (ocultar_smaley === 'ocultar') { // activar

      smiley.classList.remove("ocultar")
      smiley.style.display="block"

      if (oculto_gif !== 'ocultar') { // desactivar el gif que estaba activada

        gif.style.display="none"
        gif.className += " ocultar"
        gif.classList.remove("sfade1")

      }

      if (oculto_meme !== 'ocultar') { // desactivar el meme que estaba activada

        meme.style.display="none"
        meme.className += " ocultar"
        meme.classList.remove("sfade1")

      }

      if (oculto_audio !== 'ocultar') { // desactivar el meme que estaba activada

        audio.style.display="none"
        audio.className += " ocultar"
        audio.classList.remove("sfade1")

      }

    }else{

      smiley.className += " ocultar"
      smiley.style.display="none"
      smiley.classList.remove("sfade1")

    }

  }

  function montar_audio (valor) {

    let smiley = document.getElementsByClassName('smiley_none')[0]
    let gif = document.getElementsByClassName('gif_none')[0]
    let meme = document.getElementsByClassName('meme_none')[0]
    let audio = document.getElementsByClassName('audio_none')[0]

    let cadena_text_audio = audio.className
    let oculto_audio = cadena_text_audio.substr(11,18)

    let cadena_text_meme = meme.className
    let oculto_meme = cadena_text_meme.substr(10,18)

    let cadena_text_smaley = smiley.className
    let ocultar_smaley = cadena_text_smaley.substr(12,19)

    let cadena_text_gif = gif.className
    let oculto_gif = cadena_text_gif.substr(9,16)

    if (oculto_audio === 'ocultar') { // activar

      audio.classList.remove("ocultar")
      audio.style.display="block"

      if (ocultar_smaley !== 'ocultar') {  // desactivar el smaley que estaba activado

        smiley.style.display="none"
        smiley.className += " ocultar"
        smiley.classList.remove("sfade1")

      }

      if (oculto_gif !== 'ocultar') {  // desactivar el gif que estaba activado

        gif.style.display="none"
        gif.className += " ocultar"
        gif.classList.remove("sfade1")

      }

      if (oculto_meme !== 'ocultar') { // desactivar el meme que estaba activada

        meme.style.display="none"
        meme.className += " ocultar"
        meme.classList.remove("sfade1")

      }

    }else{

      audio.className += " ocultar"
      audio.style.display="none"
      audio.classList.remove("sfade1")

    }


  }


  function mostrar_ocultar_gif(valor) {

    let smiley = document.getElementsByClassName('smiley_none')[0]
    let gif = document.getElementsByClassName('gif_none')[0]
    let meme = document.getElementsByClassName('meme_none')[0]
    let audio = document.getElementsByClassName('audio_none')[0]

    let cadena_text_audio = audio.className
    let oculto_audio = cadena_text_audio.substr(11,18)

    let cadena_text_meme = meme.className
    let oculto_meme = cadena_text_meme.substr(10,18)

    let cadena_text_smaley = smiley.className
    let ocultar_smaley = cadena_text_smaley.substr(12,19)

    let cadena_text_gif = gif.className
    let oculto_gif = cadena_text_gif.substr(9,16)

    if (oculto_gif === 'ocultar') { // activar

      gif.classList.remove("ocultar")
      gif.style.display="block"

      if (ocultar_smaley !== 'ocultar') {  // desactivar el smaley que estaba activado

        smiley.style.display="none"
        smiley.className += " ocultar"
        smiley.classList.remove("sfade1")

      }

      if (oculto_meme !== 'ocultar') {  // desactivar el smaley que estaba activado

        meme.style.display="none"
        meme.className += " ocultar"
        meme.classList.remove("sfade1")

      }

      if (oculto_audio !== 'ocultar') { // desactivar el meme que estaba activada

        audio.style.display="none"
        audio.className += " ocultar"
        audio.classList.remove("sfade1")

      }

    }else{

      gif.className += " ocultar"
      gif.style.display="none"
      gif.classList.remove("sfade1")

    }

  }

  function mostrar_ocultar_meme () {

    let smiley = document.getElementsByClassName('smiley_none')[0]
    let gif = document.getElementsByClassName('gif_none')[0]
    let meme = document.getElementsByClassName('meme_none')[0]
    let audio = document.getElementsByClassName('audio_none')[0]

    let cadena_text_audio = audio.className
    let oculto_audio = cadena_text_audio.substr(11,18)

    let cadena_text_meme = meme.className
    let oculto_meme = cadena_text_meme.substr(10,18)

    let cadena_text_smaley = smiley.className
    let ocultar_smaley = cadena_text_smaley.substr(12,19)

    let cadena_text_gif = gif.className
    let oculto_gif = cadena_text_gif.substr(9,16)

    if (oculto_meme === 'ocultar') { // activar

      meme.classList.remove("ocultar")
      meme.style.display="block"

      if (ocultar_smaley !== 'ocultar') {  // desactivar el smaley que estaba activado

        smiley.style.display="none"
        smiley.className += " ocultar"
        smiley.classList.remove("sfade1")

      }

      if (oculto_gif !== 'ocultar') {  // desactivar el gif que estaba activado

        gif.style.display="none"
        gif.className += " ocultar"
        gif.classList.remove("sfade1")

      }

      if (oculto_audio !== 'ocultar') { // desactivar el meme que estaba activada

        audio.style.display="none"
        audio.className += " ocultar"
        audio.classList.remove("sfade1")

      }

    }else{

      meme.className += " ocultar"
      meme.style.display="none"
      meme.classList.remove("sfade1")

    }

  }


  onx=de('online_title')
  onl=de('online_users')
  log=de('chat_area')
  inp=de('text_input')
  aus=de('autoscroll')
  hst=de('hidescreen_tran')
  hso=de('hidescreen_opaq')
  hsp=de('hidescreen_part')
  sys=de('system_info')
  lof=de('box_emoji_stickers')
  sti=de('list_of_stickers')
  lie=de('list_of_emoji')
  pan=de('panel_left')
  pab=de('panel_bottom')
  ons=de('statuses')
  uin=de('user_info')
  unn=de('user_name')
  sms=de('bottom_send')
  fmc=de('fcontent')
  pch=de('private_chats')
  btl=de('rbgcolor')

  <?php
    print $rooms2js;
  ?>

  current_room=<?php print $landing_room;?>; recalc_msg();
  btl.style.backgroundColor='#'+rooms[current_room][0];
  log.className='bgbwsp rr'+current_room;

  msgs2keep=<?php print $msgs2keep;?>;

  spinner='<div class="spinner"><div class="bounce1 x_accent_bg"></div><div class="bounce2 x_accent_bg"></div><div class="bounce3 x_accent_bg"></div></div>'
  postint=<?php print $settings['post_interval'];?>;
  ping_period=<?php print $ping_period;?>;


  welcome_raw='<?php print $welcome;?>';
  if(welcome_raw!='{PREVIOUSLY}'){
    welcome_msg='';
    setTimeout("if(de('welcome_msg')){de('welcome_msg').innerHTML=roomhistbutton}",12000)
  }else{
    welcome_msg='<div id="welcome_msg"></div>';load_history=1
  }
  emos=new Array();

  <?php
    print $emos2js;
  ?>

  gnames=new Array();

  rcodes=new Array();

  <?php
    print $rcodejs;
  ?>

  lang=new Array();

  <?php
    print $lang2js;
  ?>

  <?php
    print $badwordsfilter;
  ?>

  <?php
    print $placeholders;
  ?>

  <?php
    print $stick2js;
  ?>

  if(stickers.length<2){
    de('emoji_button').style.display='none'
  }

  <?php

    foreach ($sticker_sets as $key => $value){
      print "stickers_$key ='$value'; ";
    }

  ?>

  msghint=b64e(lang['message']);placeholders.push(msghint);
  time_ampm=2; sound_on=1; bg_sound=1; pm_reg=0; color=0; pan.style.display='none';
  postint=<?php print $settings['post_interval'];?>

  <?php
    if($settings['dimonblur']>0){
  ?>

    window.onfocus=function(){
      manage_wfocus(1)
    }

    window.onblur=function(){
      manage_wfocus(0)
    }

  <?php
    }
  ?>

  window.onmouseup=function(){
    dragdown=false
  }

  document.onkeyup=function(event){
    if(event.keyCode==27){
      manage_esc()
    }
  }

  document.onkeydown=function(e){
    if(e.shiftKey && e.ctrlKey){
      key_changer(e.keyCode)
    }else{
      keyscroll(e.keyCode)
    }
  }

  log.addEventListener("touchstart", ttouch1)
  log.addEventListener("touchend", ttouch2)
  onl.addEventListener("wheel", w2move)

  window.addEventListener('click',acntx)
  window.addEventListener('wheel',acntx)
  window.addEventListener('keypress',acntx)
  window.addEventListener('touchstart',acntx)

  <?php
    if($settings['rmb_unsent']>0){
      print 'rmb_unsent=true;';
    }else{
      print 'rmb_unsent=false;';
    }
  ?>
  <?php
    if($settings['whee2scroll']>0){
      print 'log.addEventListener("wheel", wmove)';
    }
  ?>

  if(mobile>0){
    log.style.overflow='auto';onl.style.overflow='auto';
    lof.style.overflow='auto'
  }

  <?php
    if($settings['drag2scroll']<1){
      print 'nselect(1);setTimeout(\'function nselect(a){}\',500);';
    }
  ?>
  inp_focus();
  <?php

    if($settings['ctab_display']>0 && $settings['ctab_default']>0){
      print 'swap_panel(4);';
    }else{
      if(count($rooms)>1){
        print 'swap_panel(0);';
      }else{
        print 'swap_panel(1);';
      }
    }


    if($user_visible>0){
      print 'stealth=0;';
    }else{
      print 'stealth=1;constructcount=2;';
    }
    if(strlen($ufake)>0){
      print $ufake;
    }else{
      print 'fls_online={};';
    }

  ?>

  myuuid=<?php print $uid;?>;
  stoken='<?php print $stoken;?>';
  ptoken='<?php print $ptoken;?>';
  mtoken='<?php print $mtoken;?>';
  tpoint=<?php print $timestamp;?>;

  chatflow=0;

  // local storage

  storkey_opt='<?php print $storage_options;?>';

  try{
    store_opt=localStorage.getItem(storkey_opt)
  }catch(e){
    console.log('localStorage disabled. You cannot save settings...');
    store_opt={}
  }

  storkey_snd='<?php print $storage_xsounds;?>';

  try{
    store_snd=localStorage.getItem(storkey_snd)
  }catch(e){
    console.log('localStorage disabled. You cannot save sound options...');
    store_snd={}
  }

  storkey_ign='<?php print $storage_ignored;?>';

  try{
    store_ign=localStorage.getItem(storkey_ign)
  }catch(e){
    console.log('localStorage disabled. You cannot save muted users...');
    store_ign={}
  }

  try{
    users_ignored=JSON.parse(store_ign)
  }catch(e){
    users_ignored=null
  }

  if(!users_ignored){
    users_ignored={}
  }

  for(i in users_ignored){
    ignored_users[i]=users_ignored[i]
  }

  try{
    sound_options=JSON.parse(store_snd)
  }catch(e){
    sound_options=null
  }
  if(!sound_options){
    sound_options={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1}
  }
  if(mobile==1 && mobileapp<2){
    sound_options={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0}
  }
  sound_opt_init();

  current_color=0;

  try{
    settings=JSON.parse(store_opt)
  }catch(e){
    settings=null
  }

  if(!settings){
    settings={
      'ampm':<?php print $settings['default_ampm'];?>,
      'sound':<?php print $settings['default_sound'];?>,
      'color':0,
      'colva':'',
      'pmreg':0
    }
  }

  if(settings['ampm']<2){
    swap_ampm(0)
  }
  if(settings['ampm']<1){
    swap_ampm(0)
  }
  if(settings['sound']<1){
    swap_sound(0)
  }
  if(settings['color']>0){
    swap_color(settings['color'],settings['colva'],1)
  }
  if(settings['pmreg']>0){
    swap_pmreg(0,'<?php print $lang['on'];?>','<?php print $lang['off'];?>')
  }
  // ---

</script>
<script src="recorder.js"></script>
<?php print $settings['bottomjs'];?>

</body>
</html>